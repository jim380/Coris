<div class="row" *ngIf="(appState | async).validators.serviceLoaded; else elseBlock">
  <!-- @aakatev	
    https://github.com/cosmos/cosmos-sdk/blob/9a16e2675f392b083dd1074ff92ff1f9fbda750d/types/staking.go
    Unbonded  BondStatus = 0x00
    Unbonding BondStatus = 0x01
    Bonded BondStatus = 0x02 
  -->
  <div class="bond-status">
    <mat-button-toggle-group name="fontStyle" aria-label="Font Style">
      <mat-button-toggle (click)="validatorsBondFilter(2)">Bonded</mat-button-toggle>
      <mat-button-toggle (click)="validatorsJailedFilter(true)">Jailed</mat-button-toggle>
      <mat-button-toggle (click)="validatorsFilter(0, false)">Unbonded</mat-button-toggle>
      <mat-button-toggle (click)="validatorsBondFilter(1)">Uhnbonding</mat-button-toggle>
      <mat-button-toggle (click)="validatorsNoFilter()">All</mat-button-toggle>
    </mat-button-toggle-group>    
  </div>
  <table  mat-table matSort (matSortChange)="sortData($event)" [dataSource]="dataSource" class="mat-elevation-z8">
    <!-- <ng-container matColumnDef="index">
      <th mat-header-cell *matHeaderCellDef> Index </th>
      <td mat-cell *matCellDef="let validator"> {{0}} </td>
    </ng-container> -->
    <ng-container  matColumnDef="moniker">
      <th mat-sort-header="name" mat-header-cell *matHeaderCellDef> Name </th>
      <td mat-cell *matCellDef="let validator" id="{{validator.hex_address}}"> 
        <span>
          <figure style="cursor: pointer;" (click)="openDialog(validator)" class="validator-avatar is-128x128" *ngIf="validator.keybase">
            <img  
              *ngIf="!validator.picture; else elseBlock" 
              src="https://ui-avatars.com/api/?size=50&name={{validator.description.moniker}}" 
              alt="avatar">
            <ng-template #elseBlock>
              <img src="{{validator.picture}}" alt="avatar">
            </ng-template>
            {{validator.description.moniker}}
          </figure>
        </span>
        <!-- <span class="moniker">{{validator.description.moniker}}</span> -->
      </td>
    </ng-container>
  
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef> Status/Uptime </th>
      <td mat-cell *matCellDef="let validator">  
        <span *ngIf="validator.jailed"><i class="ion-record jailed"></i></span>
        <span *ngIf="!validator.jailed"><i class="ion-record jailedNot"></i></span>
        <span
          *ngFor="let block of (appState | async).blocks.slice(0,1)"
          [innerHTML]=
          "block.header?.height !== null
          ? 100-validator.slashing?.missed_blocks_counter/(block.header.height-validator.slashing?.start_height) : 0"
          >
        </span>
      </td>
    </ng-container>
  
    <ng-container matColumnDef="weight">
      <th mat-sort-header="weight" mat-header-cell *matHeaderCellDef> Voting Weight </th>
      <td mat-cell *matCellDef="let validator">
        {{validator.tokens/1e6 | number:'.0-0'}}
        <br>
        <span class="table-subtitle" matTooltip="Percentage" matTooltipPosition="above"><i class="ion-calculator"></i>&nbsp;{{validator.tokens/(appState | async).totalStake| percent:'.2-2'}}</span>
      </td>
    </ng-container>
  
    

    <ng-container matColumnDef="assets">
      <th mat-header-cell *matHeaderCellDef> Assets </th>
      <td mat-cell *matCellDef="let validator">
        <span *ngIf="validator.account?.tokens; else accountElseBlock" matTooltip="Balance" matTooltipPosition="above">
          {{validator.account?.tokens/1e6 | number:'.2-2'}}
        </span>
        <ng-template #accountElseBlock>
          0
        </ng-template>
        <span class="ticker"> ATOM</span>
        <br>
        <span class="table-subtitle" matTooltip="Rewards" matTooltipPosition="above">
          <i class="ion-ios-pricetags"></i>&nbsp;
          <span *ngIf="validator.rewards">
            {{validator.rewards[0].amount/1e6 | number:'.2-2'}}<span class="ticker-small"> ATOM</span>
            <!-- {{validator.rewards[0].denom}} -->
          </span>
        </span>
      </td>
    </ng-container>

    <ng-container matColumnDef="delegators">
      <th mat-header-cell *matHeaderCellDef> Delegators </th>
      <td mat-cell *matCellDef="let validator"> 
        <span *ngIf="validator.delegations; else otherBlock">
          {{validator.delegations?.length}}
        </span>
        <ng-template #otherBlock>
          <span>-</span>
        </ng-template>
      </td>
    </ng-container>

    <ng-container matColumnDef="unbond">
      <th mat-header-cell *matHeaderCellDef> Unbond </th>
      <td mat-cell *matCellDef="let validator">
        Unbonding stake<br>
        <span class="table-subtitle" matTooltip="Completion Time" matTooltipPosition="above"><i class="ion-android-time"></i>&nbsp;completion time</span>
      </td>
    </ng-container>
    
<!-- 
    <ng-container matColumnDef="blockTime">
      <th mat-header-cell *matHeaderCellDef> Block Time </th>
      <td mat-cell *matCellDef="let validator">  
        Add blocktime
      </td>
    </ng-container>
   -->
      <ng-container matColumnDef="bond">
        <th mat-header-cell *matHeaderCellDef> Self-Bond </th>
        <td mat-cell *matCellDef="let validator">
          {{validator.self_bond/1e6 | number:'.0-0'}} <span class="ticker">ATOM</span>
          <br>
          <span class="table-subtitle" matTooltip="Percentage" matTooltipPosition="above"><i class="ion-calculator"></i>&nbsp;{{ validator.self_bond / validator.tokens | percent:'.2-2' }}</span>
        </td>
      </ng-container>
        

    <ng-container matColumnDef="commission">
      <th mat-header-cell *matHeaderCellDef> Commission </th>
      <td mat-cell *matCellDef="let validator">
        <span matTooltip="Current Rate" matTooltipPosition="above">{{validator.commission?.rate | percent}}</span><br>
        <span class="table-subtitle" matTooltip="Max Rate - Max Change Rate" matTooltipPosition="above"><i class="ion-calculator"></i>&nbsp;{{validator.commission?.max_rate | percent}} - {{validator.commission?.max_change_rate | percent}}</span>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" [appBgHighlight]="'#383D4C'" defaultColor="#111923"></tr>
  </table>

</div>
<ng-template #elseBlock>
  <div style="display: flex; justify-content: center;">
    <mat-spinner [diameter]="30"></mat-spinner>
  </div> 
</ng-template>