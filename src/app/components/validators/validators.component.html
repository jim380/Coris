<div class="row" *ngIf="(appState | async).validators.serviceLoaded; else elseBlock">
  <!-- <button
    (click)="openDialog()"
    mat-raised-button>open
  </button> -->
  <table  mat-table matSort (matSortChange)="sortData($event)" [dataSource]="dataSource" class="mat-elevation-z8">
    <!-- <ng-container matColumnDef="index">
      <th mat-header-cell *matHeaderCellDef> Index </th>
      <td mat-cell *matCellDef="let validator"> {{0}} </td>
    </ng-container> -->
    <ng-container  matColumnDef="moniker">
      <th mat-sort-header="name" mat-header-cell *matHeaderCellDef> Name </th>
      <td mat-cell *matCellDef="let validator" id="{{validator.hex_address}}"> 
        <span>
          <figure style="cursor: pointer;" (click)="openDialog(validator)" class="validator-avatar is-128x128" *ngIf="validator.keybase">
            <img  
              *ngIf="!validator.picture; else elseBlock" 
              src="https://ui-avatars.com/api/?size=50&name={{validator.description.moniker}}" 
              alt="avatar">
            <ng-template #elseBlock>
              <img src="{{validator.picture}}" alt="avatar">
            </ng-template>
            {{validator.description.moniker}}
          </figure>
        </span>
        <!-- <span class="moniker">{{validator.description.moniker}}</span> -->
      </td>
    </ng-container>
  
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef> Status/Uptime </th>
      <td mat-cell *matCellDef="let validator">  
        <span *ngIf="validator.jailed"><i class="ion-record jailed"></i></span>
        <span *ngIf="!validator.jailed"><i class="ion-record jailedNot"></i></span>
        <span
          *ngFor="let block of (appState | async).blocks.slice(0,1)"
          [innerHTML]=
          "block.header?.height !== null
          ? 100-validator.slashing?.missed_blocks_counter/(block.header.height-validator.slashing?.start_height) : 0"
          >
        </span>
      </td>
    </ng-container>
  
    <ng-container matColumnDef="weight">
      <th mat-sort-header="weight" mat-header-cell *matHeaderCellDef> Voting Weight </th>
      <td mat-cell *matCellDef="let validator">
        {{validator.tokens/1e6 | number:'.0-0'}}
        <br>
        <span class="table-subtitle" matTooltip="Percentage" matTooltipPosition="above"><i class="ion-calculator"></i>&nbsp;{{validator.tokens/(appState | async).totalStake| percent:'.2-2'}}</span>
      </td>
    </ng-container>
  
    

    <ng-container matColumnDef="assets">
      <th mat-header-cell *matHeaderCellDef> Assets </th>
      <td mat-cell *matCellDef="let validator">balance<br>
        <span class="table-subtitle" matTooltip="Rewards" matTooltipPosition="above"><i class="ion-ios-pricetags"></i>&nbsp;rewards</span>
      </td>
    </ng-container>

    <ng-container matColumnDef="delegators">
      <th mat-header-cell *matHeaderCellDef> Delegators </th>
      <td mat-cell *matCellDef="let validator"> 
        <span *ngIf="validator.delegations; else otherBlock">
          {{validator.delegations?.length}}
        </span>
        <ng-template #otherBlock>
          <span>-</span>
        </ng-template>
      </td>
    </ng-container>

    <ng-container matColumnDef="unbond">
      <th mat-header-cell *matHeaderCellDef> Unbond </th>
      <td mat-cell *matCellDef="let validator">
        Unbonding stake<br>
        <span class="table-subtitle" matTooltip="Completion Time" matTooltipPosition="above"><i class="ion-android-time"></i>&nbsp;completion time</span>
      </td>
    </ng-container>
    

    <ng-container matColumnDef="blockTime">
      <th mat-header-cell *matHeaderCellDef> Block Time </th>
      <td mat-cell *matCellDef="let validator">  
        Add blocktime
      </td>
    </ng-container>
  
      <ng-container matColumnDef="bond">
        <th mat-header-cell *matHeaderCellDef> Self-Bond </th>
        <td mat-cell *matCellDef="let validator">
          {{validator.self_bond/1e6 | number:'.0-0'}} <span class="ticker">ATOM</span>
          <br>
          <span class="table-subtitle" matTooltip="Percentage" matTooltipPosition="above"><i class="ion-calculator"></i>&nbsp;{{ validator.self_bond / validator.tokens | percent:'.2-2' }}</span>
        </td>
      </ng-container>
        

    <ng-container matColumnDef="commission">
      <th mat-header-cell *matHeaderCellDef> Commission </th>
      <td mat-cell *matCellDef="let validator">
        <span matTooltip="Current Rate" matTooltipPosition="above">{{validator.commission?.rate | percent}}</span><br>
        <span class="table-subtitle" matTooltip="Max Rate - Max Change Rate" matTooltipPosition="above"><i class="ion-calculator"></i>&nbsp;{{validator.commission?.max_rate | percent}} - {{validator.commission?.max_change_rate | percent}}</span>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" [appBgHighlight]="'#383D4C'" defaultColor="#111923"></tr>
  </table>
    
      

<!--   
  <div class="field is-grouped">
    <p class="control">
        <a 
        class="button is-primary tag" 
        (click)="sortByPower()"
        style="font-size: 2rem;">
          Sort By Power
      </a>
    </p>
  </div>
  <div class="card events-card">
      <div class="card-header">
        <p class="card-header-title"><i class="fas fa-vector-square"></i>Validators</p>
      </div>
      <div class="card-table">
          <table class="table is-fullwidth">
            <thead>
              <tr>
                <th> </th>
                <th >Name</th>
                <th>Status/Uptime</th>
                <th>Voting Weight</th>
                <th>Assets</th>
                <th>Bond</th>
                <th>Unbond</th>
                <th>Delegators</th>
                <th>Commission</th>
                <th>Geolocation (or block time)</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let validator of (appState | async).validators; index as i"
              class="validator-card"
              id="{{validator.keys?.Addres}}">
                <td class="td-vertical">{{i}}</td>
                <td class="td-1">
                  <div class="col span-1-of-2 col-avatar">
                      <figure class="validatoe-avatar is-128x128" *ngIf="validator.keybase">
                          <img  *ngIf="!validator.picture; else elseBlock" 
                            src="https://ui-avatars.com/api/?size=50&name={{validator.description.moniker}}" 
                            alt="avatar"
                          >
                          <ng-template #elseBlock>
                            <img src="{{validator.picture}}" alt="avatar">
                          </ng-template>
                      </figure>
                  </div>
                  <div class="col span-1-of-2 td-vertical col-moniker">
                      {{validator.description.moniker}}
                  </div>
                </td>
                <td class="td-2 td-vertical">
                  <span *ngIf="validator.jailed"><i class="ion-record jailed"></i></span>
                  <span *ngIf="!validator.jailed"><i class="ion-record jailedNot"></i></span>
                  <span
                    *ngFor="let block of (appState | async).blocks.slice(0,1)"
                    [innerHTML]=
                    "block.header?.height !== null
                    ? 100-validator.slashing?.missed_blocks_counter/(block.header.height-validator.slashing?.start_height) : 0"
                    >
                  </span>
                </td>
                <td class="td-1">
                  {{validator.tokens/1e6 | number:'.0-0'}}
                  <br>
                  <span class="weightPerct">({{validator.tokens/(appState | async).totalStake| percent:'.2-2'}})</span></td>
                <td class="td-2">
                  - balances<br>- rewards
                </td>
                <td class="td-2 td-vertical">
                  self-bond<br>(in %)
                </td>
                <td class="td-2 td-vertical">
                  - Un-bond<br>- completion time
                  </td>
                <td *ngIf="validator.delegations; else otherBlock" class="td-2 td-vertical">
                  {{validator.delegations?.length}}
                </td>
                <ng-template #otherBlock>
                    <td class="td-2 td-vertical">-</td>
                </ng-template>
                <td class="td-2 td-vertical">{{validator.commission?.rate | percent}}-maxRate-maxChangeRate</td>
                <td>
                  -
                </td>
              </tr>
            </tbody>
          </table>
      </div>
  </div> -->

</div>
<ng-template #elseBlock>
  <div style="display: flex; justify-content: center;">
    <mat-spinner [diameter]="30"></mat-spinner>
  </div> 
</ng-template>