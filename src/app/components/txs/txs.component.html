<span *ngIf="txs && txs.length >= INITIAL_TXS_COUNT; else elseLoading">
  <div (scroll)="onScroll($event)" class="row table-responsive text-nowrap scrollbar-primary main-row mat-elevation-z8">
    <div class="container">
      <div class="row">
        <div class="col-8">
          <mat-form-field>
            <input #queryInputRef matInput placeholder="Enter tx hash">
          </mat-form-field>
        </div>
        <div class="col-4">
          <button (click) = "queryTx(queryInputRef.value)" mat-raised-button color="accent">Search</button>    
        </div>
      </div>
      <!-- TEST ACCOUNT QUERY -->
      <!-- <div class="row">
        <div class="col-8">
          <mat-form-field>
            <input #queryInputRef2 matInput placeholder="Enter account address">
          </mat-form-field>
        </div>
        <div class="col-4">
          <button (click) = "queryAccount(queryInputRef2.value)" mat-raised-button color="accent">Search</button>    
        </div>
      </div> -->
      <!-- END TEST ACCOUNT QUERY -->
    </div>
    <table mat-table
          [dataSource]="dataSource" 
          multiTemplateDataRows
          class="mat-elevation-z8 w-auto">

      <ng-container matColumnDef="hash" sticky>
        <th mat-header-cell *matHeaderCellDef class="th-lg"><i class="ion-pound"></i>&nbsp;Hash</th>
        <td mat-cell *matCellDef="let tx" mdbWavesEffect> 
          <span>
            {{tx.hash | slice:0:15 }}... 
            <i 
              class="ion-ios-copy copy-button" 
              style="cursor: pointer;" 
              ngxClipboard 
              [cbContent]="tx.hash" 
              (click)="onCopySucceess()"
              mdbTooltip="copy to clipboard" placement="left">
            </i>
          </span>
          </td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef class="th-lg"><i class="ion-document-text"></i>&nbsp;Type</th>
        <td mat-cell *matCellDef="let tx">
          <mat-chip-list>
            <mat-chip color = "primary" selected>
              <span *ngIf="tx.action && tx.action.length > 0; else elseAction">
                {{ tx.action[0] | titlecase }}
              </span>
              <ng-template #elseAction>
                {{ tx.error | titlecase }}
              </ng-template>
            </mat-chip>
            </mat-chip-list></td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef class="th-lg"><i class="ion-android-checkbox-outline"></i>&nbsp;Status</th>
        <td mat-cell *matCellDef="let tx"> 
          <span *ngIf="!tx.error; else elseStatus"><i class="ion-checkmark-circled success"></i></span>
          <ng-template #elseStatus>
            <i class="ion-close-circled fail"></i>
          </ng-template>
        </td>
      </ng-container>

      <ng-container matColumnDef="fee">
        <th mat-header-cell *matHeaderCellDef class="th-lg"><i class="ion-card"></i>&nbsp;Fee</th>
        <td mat-cell *matCellDef="let tx"> 
          {{ 
            tx.fee?.amount ?
            tx.fee.amount[0].amount : '0' 
          }}&nbsp;<span class="ticker">uatom</span> 
        </td>
      </ng-container>

      <ng-container matColumnDef="height">
        <th mat-header-cell *matHeaderCellDef class="th-lg"><i class="ion-soup-can"></i>&nbsp;Height</th>
        <td mat-cell *matCellDef="let tx"> {{tx.height}} </td>
      </ng-container>

      <ng-container matColumnDef="timestamp">
        <th mat-header-cell *matHeaderCellDef class="th-lg"><i class="ion-clock"></i>&nbsp;Time</th>
        <td mat-cell *matCellDef="let tx"> {{tx.details?.timestamp | ago | async}} </td>
      </ng-container>

      <ng-container matColumnDef="expandedDetail">
        <td mat-cell *matCellDef="let tx" [attr.colspan]="displayedColumns.length" class="tx-detail">
          <div
              [@detailExpand]="tx == expandedElement ? 'expanded' : 'collapsed'">
              <mdb-card class="text-left mb-3" bgColor="bg-light">
                <mdb-card-body>
                  <mdb-card-text class="text-left">
                    <span *ngFor="let action of tx.action; index as i">

                      <span *ngIf="tx.msg[i].type === 'cosmos-sdk/MsgSend'">
                        <a (click)="openTxsListDialog( tx.msg[i].value.from_address )"> 
                          <span *ngIf="(appState | async).valsMap.size 
                                        ? (appState | async).valsMap.has( tx.msg[i].value.from_address ) 
                                        : false; else elseFromSend">
                            {{ (appState | async).valsMap.get( tx.msg[i].value.from_address )}}
                          </span>
                          <ng-template #elseFromSend>{{ tx.msg[i].value.from_address }}</ng-template>
                        </a>
                        <br>
                        <mdb-badge default="true">sent</mdb-badge>&nbsp;
                        <span *ngIf="tx.msg[i].value.amount">
                          <span class="txn-amount">{{ tx.msg[i].value.amount[0].amount/1e6 | number:".2-2" }}&nbsp;ATOM</span>
                          <!-- {{ tx.msg[i].value.amount[0].denom }}  -->
                        </span>
                        to 
                        <br>
                        <a (click)="openTxsListDialog( tx.msg[i].value.to_address )"> 
                          <span *ngIf="(appState | async).valsMap.size 
                                        ? (appState | async).valsMap.has( tx.msg[i].value.to_address ) 
                                        : false; else elseToSend">
                            {{ (appState | async).valsMap.get( tx.msg[i].value.to_address )}}
                          </span>
                          <ng-template #elseToSend>{{ tx.msg[i].value.to_address }}</ng-template>
                        </a>                          
                      </span>

                      <span *ngIf="tx.msg[i].type === 'cosmos-sdk/MsgDelegate' 
                            || tx.msg[i].type === 'cosmos-sdk/MsgUndelegate'">
                        <a (click)="openTxsListDialog( tx.msg[i].value.delegator_address )"> 
                          <span *ngIf="(appState | async).valsMap.size 
                                        ? (appState | async).valsMap.has( tx.msg[i].value.delegator_address ) 
                                        : false; else elseDelegatorDelegate">
                            {{ (appState | async).valsMap.get( tx.msg[i].value.delegator_address )}}
                          </span>
                          <ng-template #elseDelegatorDelegate>{{ tx.msg[i].value.delegator_address }}</ng-template>
                        </a>                          
                        <br>
                        <span *ngIf="tx.msg[i].type === 'cosmos-sdk/MsgDelegate'; else elseDelegateBlock">
                          <mdb-badge default="true">delegated</mdb-badge>&nbsp;
                          <span *ngIf="tx.msg[i].value.amount">
                            <span class="txn-amount">{{ tx.msg[i].value.amount.amount/1e6 | number:".2-2" }}&nbsp;ATOM</span>
                          </span>
                          to 
                        </span>
                        <ng-template #elseDelegateBlock>
                          <mdb-badge default="true">undelegated</mdb-badge>&nbsp;
                          <span *ngIf="tx.msg[i].value.amount">
                            <span class="txn-amount">{{ tx.msg[i].value.amount.amount/1e6 | number:".2-2" }}&nbsp;ATOM</span>
                          </span>
                          from 
                        </ng-template>
                        <br>
                        <a (click)="openValidatorDialog( tx.msg[i].value.validator_address )"> 
                          <span *ngIf="(appState | async).valsMap.size 
                                        ? (appState | async).valsMap.has( tx.msg[i].value.validator_address ) 
                                        : false; else elseValidatorDelegate">
                            {{ (appState | async).valsMap.get( tx.msg[i].value.validator_address )}}
                          </span>
                          <ng-template #elseValidatorDelegate>{{ tx.msg[i].value.validator_address }}</ng-template>
                        </a>                                              
                      </span>

                      <span *ngIf="tx.msg[i].type === 'cosmos-sdk/MsgMultiSend'">
                        <span *ngFor="let input of tx.msg[i].value.inputs">
                          <a (click)="openTxsListDialog( input.address )"> 
                            <span *ngIf="(appState | async).valsMap.size 
                                          ? (appState | async).valsMap.has( input.address ) 
                                          : false; else elseInputMulti">
                              {{ (appState | async).valsMap.get( input.address )}}
                            </span>
                            <ng-template #elseInputMulti>{{ input.address }}</ng-template>
                          </a>                          
                          <br>
                          <mdb-badge default="true">sent</mdb-badge>&nbsp;
                          <span class="txn-amount">{{ input.coins[0].amount/1e6 | number:".2-2" }}&nbsp;ATOM</span>
                        </span>
                        to
                        <br>
                        <span *ngFor="let output of tx.msg[i].value.outputs">
                          <a (click)="openTxsListDialog( output.address )"> 
                            <span *ngIf="(appState | async).valsMap.size 
                                          ? (appState | async).valsMap.has( output.address ) 
                                          : false; else elseOutputMulti">
                              {{ (appState | async).valsMap.get( output.address )}}
                            </span>
                            <ng-template #elseOutputMulti>{{ output.address }}</ng-template>
                          </a>
                          <!-- <mdb-badge default="true">sent</mdb-badge>&nbsp;{{ output.coins[0].amount/1e6 | number:".2-2" }}&nbsp;ATOM -->
                        </span>                      
                      </span>

                      <span *ngIf="tx.msg[i].type === 'cosmos-sdk/MsgWithdrawDelegationReward'">
                        <a (click)="openTxsListDialog( tx.msg[i].value.delegator_address )"> 
                          <span *ngIf="(appState | async).valsMap.size 
                                        ? (appState | async).valsMap.has( tx.msg[i].value.delegator_address ) 
                                        : false; else elseDelegatorWithdraw">
                            {{ (appState | async).valsMap.get( tx.msg[i].value.delegator_address )}}
                          </span>
                          <ng-template #elseDelegatorWithdraw>{{ tx.msg[i].value.delegator_address }}</ng-template>
                        </a> 
                        <mdb-badge default="true">withdrew rewards</mdb-badge>&nbsp;
                        from 
                        <br>
                        <a (click)="openValidatorDialog( tx.msg[i].value.validator_address )"> 
                          <span *ngIf="(appState | async).valsMap.size 
                                        ? (appState | async).valsMap.has( tx.msg[i].value.validator_address ) 
                                        : false; else elseValidatorWithdraw">
                            {{ (appState | async).valsMap.get( tx.msg[i].value.validator_address )}}
                          </span>
                          <ng-template #elseValidatorWithdraw>{{ tx.msg[i].value.validator_address }}</ng-template>
                        </a>    
                        <br>
                        <hr>                            
                      </span>

                      <span *ngIf="tx.msg[i].type === 'cosmos-sdk/MsgBeginRedelegate'">
                        <a (click)="openTxsListDialog( tx.msg[i].value.delegator_address )"> 
                          <span *ngIf="(appState | async).valsMap.size 
                                        ? (appState | async).valsMap.has( tx.msg[i].value.delegator_address ) 
                                        : false; else elseDelegatorRedelegate">
                            {{ (appState | async).valsMap.get( tx.msg[i].value.delegator_address )}}
                          </span>
                          <ng-template #elseDelegatorRedelegate>{{ tx.msg[i].value.delegator_address }}</ng-template>
                        </a>
                        <br> 
                        <mdb-badge default="true">redelegated</mdb-badge>&nbsp;
                        <span *ngIf="tx.msg[i].value.amount">
                          <span class="txn-amount">{{ tx.msg[i].value.amount.amount/1e6 | number:".2-2" }}&nbsp;ATOM</span>
                        </span>
                        from 
                        <br>
                        <a (click)="openValidatorDialog( tx.msg[i].value.validator_src_address )"> 
                          <span *ngIf="(appState | async).valsMap.size 
                                        ? (appState | async).valsMap.has( tx.msg[i].value.validator_src_address ) 
                                        : false; else elseSrcValidatorRedelegate">
                            {{ (appState | async).valsMap.get( tx.msg[i].value.validator_src_address )}}
                          </span>
                          <ng-template #elseSrcValidatorRedelegate>
                            {{ tx.msg[i].value.validator_src_address }}
                            <br>
                          </ng-template>
                        </a>
                        to 
                        <a (click)="openValidatorDialog( tx.msg[i].value.validator_dst_address )"> 
                          <span *ngIf="(appState | async).valsMap.size 
                                        ? (appState | async).valsMap.has( tx.msg[i].value.validator_dst_address ) 
                                        : false; else elseDstValidatorRedelegate">
                            {{ (appState | async).valsMap.get( tx.msg[i].value.validator_dst_address )}}
                          </span>
                          <ng-template #elseDstValidatorRedelegate>
                            <br>
                            {{ tx.msg[i].value.validator_dst_address }}
                          </ng-template>
                        </a>    
                        <br>
                        <hr>                            
                      </span>

                      <span *ngIf="tx.msg[i].type === 'cosmos-sdk/MsgWithdrawValidatorCommission'">
                        <a (click)="openValidatorDialog( tx.msg[i].value.validator_address )"> 
                          <span *ngIf="(appState | async).valsMap.size 
                                        ? (appState | async).valsMap.has( tx.msg[i].value.validator_address ) 
                                        : false; else elseValidatorWithdrawCommission">
                            {{ (appState | async).valsMap.get( tx.msg[i].value.validator_address )}}
                          </span>
                          <ng-template #elseValidatorWithdrawCommission>{{ tx.msg[i].value.validator_address }}</ng-template>
                        </a>
                        <br>
                        <mdb-badge default="true">withdrew</mdb-badge>&nbsp;
                        commission
                        <br>                           
                      </span>

                      <span *ngIf="tx.msg[i].type === 'cosmos-sdk/MsgCreateValidator'">
                        <a (click)="openTxsListDialog( tx.msg[i].value.delegator_address )"> 
                          <span *ngIf="(appState | async).valsMap.size 
                                        ? (appState | async).valsMap.has( tx.msg[i].value.delegator_address ) 
                                        : false; else elseDelegatorCreate">
                            {{ (appState | async).valsMap.get( tx.msg[i].value.delegator_address )}}
                          </span>
                          <ng-template #elseDelegatorCreate>{{ tx.msg[i].value.delegator_address }}</ng-template>
                        </a>
                        <br> 
                        <mdb-badge default="true">created validator</mdb-badge>&nbsp;
                        {{ tx.msg[i].value.description.moniker }}                           
                      </span>   
                      
                      <span *ngIf="tx.msg[i].type === 'cosmos-sdk/MsgVote'">
                        <a (click)="openTxsListDialog( tx.msg[i].value.voter )"> 
                          <span *ngIf="(appState | async).valsMap.size 
                                        ? (appState | async).valsMap.has( tx.msg[i].value.voter ) 
                                        : false; else elseVote">
                            {{ (appState | async).valsMap.get( tx.msg[i].value.voter )}}
                          </span>
                          <ng-template #elseVote>{{ tx.msg[i].value.voter }}</ng-template>
                        </a>
                        <br> 
                        <mdb-badge default="true">voted</mdb-badge>&nbsp;
                        {{ tx.msg[i].value.option }} on prop.{{ tx.msg[i].value.proposal_id }}                           
                      </span>        
                    </span>
                    <span *ngIf="tx.error">
                      <mdb-badge danger="true">Error</mdb-badge>&nbsp;{{ tx.error|titlecase }}
                    </span>
                  </mdb-card-text>
                  <button mdbBtn color="indigo" rounded="true" size="sm" mdbWavesEffect 
                  style="cursor: pointer;" (click)="openTxDialog(tx)" class="detail-button">Detail</button>
                </mdb-card-body>
              </mdb-card>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let tx; columns: displayedColumns;"
          [appBgHighlight]="'#d1d1d1'" defaultColor="#ffffff"
          [class.example-expanded-row]="expandedElement === tx"
          (click)="expandedElement = expandedElement === tx ? null : tx">
      </tr>
      <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="tx-detail-row"></tr>
    </table>
    <!-- <div class="row paginator">
      <mat-paginator [hidePageSize]="true" [pageSizeOptions]="[100]"></mat-paginator>
    </div> -->
  </div>
  <div class="button-row">
    <button class="show-more" mdbBtn (click)="displayOlderTxs();" type="button" color="indigo" size="sm" block="true" mdbWavesEffect>Show More</button>
  </div>
</span>
<ng-template #elseLoading>
  <div style="display: flex; justify-content: center;">
    <mdb-spinner spinnerColor="blue"></mdb-spinner>
  </div> 
</ng-template>